// last man standing - be the last living player and win the game
// Author: /BudSpencer
// Date: 2016 
// Purpose: mainloop + functions


// main variables
isRunning = 0
winner = ""
winnerscore = -1

// constants 
countdown_time = 5
resumedelay = 5


// static functions
getlives = [ result ( - 3 ( getdeaths $arg1 ) ) ]
isdead = [ if ( || ( = ( getlifes $arg1 ) 0 ) ( isspectator $arg1 ) ) [ result 1 ] [ result 0 ] ]
getpoints = [ result ( getfrags $arg1 ) ]
numactiveplayers = [ x = 0 ; looplist cn ( allplayers ) [ if ( ! ( isspectator $cn ) ) [ x = ( + $x 1 ) ] ] result $x ]
check_deaths = [ while ( = $isRunning 1 ) [ looplist cn ( allactiveplayers ) [ if ( = ( getlives $cn ) 0 ) [ spectator 1 $cn ] [ check_deaths ] ] ] ]
check_players = [ while ( = $isRunning 1 ) [ if ( = ( numactiveplayers ) 1 ) [ forceintermission ; say ( format "Game ended!" ) ] [ check_players ] ] ]
resume_countdown = [ say ( format "^f7Match will ^f3start ^f7in ^f4%1 ^f7seconds ..." $resumedelay ) ; asleep ( * $resumedelay 1000 ) [ say ( format "^f7Game was ^f3started^f7. Frag everyone and be the last ^f4living ^f7player." ) ; pause 0 ] ; loop n ( - $resumedelay 1 ) [ asleep ( * ( + $n 1 ) 1000 ) [ say ( format "^f7Starting in ^f3%1 ^f7seconds ..." ( - $resumedelay ( + @n 1 ) ) ) ] ] ]

// start mode + mainloop 
Initzialize_Mode = [
	isRunning = 0 ; winner = "" ; winnerscore = -1 
	pause 1 ; resume_countdown ; isRunning = 1 
	
]

addhandler "onmapstart" Initzialize_Mode 

		for = [
			loop schleife $arg1 [
				$arg2
			]
		]


	
	