// Abusing Protection - kicks abuser, who kick too much
// made by /BudSpencer ( 2016 )


defaultvalue "enable_abusing_protection" 1
defaultvalue "kick_limit" 5 
defaultvalue "kick_time_for_abusing" 6 

kick_total_millis = ( * $kick_time_for_abusing 3600000 ) // 6 hours ban fro abusing

Abusing_Protection = [

kicks = ( getvar $arg1 numkicks )
kicks = ( + $kicks 1 )
setvar $arg1 numkicks $kicks 

kicker_name = ( getname $arg1 )
	kicker_cn = ( getcn $arg1 )
		

if ( = $kicks ( - $kick_limit 2 ) ) [
	
	if ( = ( getperm $arg1 ) 2 ) [
		
		saytoadmin ( format "Player(master) ^f3%1(%2) ^f7kicks too much. In ^f42 ^f7kicks, he'll reach ^f4Kick-Limit^f7." )
		
		]
	
] [
	
if ( = $kicks ( - $kick_limit 1 ) ) [

	if ( = ( getperm $arg1 ) 2 ) [
		
		saytoadmin ( format "Player(master) ^f3%1(%2) ^f7kicks too much. In ^f41 ^f7kicks, he'll reach ^f4Kick-Limit^f7." )
		
		]
	
] [

if ( = $kicks $kick_limit ) [

	if ( = ( getperm $arg1 ) 2 ) [
		
		saytoadmin ( format "Player(master) ^f3%1(%2) ^f7heached ^f4Kick-Limit^f7(%1) and is ^f3kicked ^f7now." $kick_limit )
		setvar $arg1 numkicks 0
		pm $arg1 ( format "You reached ^f3Kick-Limit^f7(%1). Abusing will be ^f4banned ^f7anyway^f7." $kick_limit )
		
		sleep 50 [
		
		kick $arg1 $kick_total_millis
		say ( format "client (%1) disconnected because: ^f3Abusing Master (bantime: %2 hours)" ( getip $arg1 ) $kick_time_for_abusing
					
					]
					
				]
				
			]
			
		]
		
	]
	
]


reset_vars = [

all = ( allplayers )
	looplist cn $all [
	
	setvar $cn numkicks 0
	
	]
	
]


addhandler "onkick" Abusing_Protection
addhandler "onmapstart" reset_vars


	
		
	