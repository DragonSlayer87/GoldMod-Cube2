// Spectates teamkiller, if he reached specified limit of teamkills
// made by /BudSpencer ( 2016 )
// experimental testing purpose


defaultvalue "enable_tk_penalty" 1
defaultvalue "teamkill_limit" 3
defaultvalue "spec_time" 30 

spec_time_total = ( * $spec_time 1000 )

Penalty_Core = [

if ( = $enable_tk_penalty 1 ) [

	pname = ( getname $arg1 )
	pcn = ( getcn $arg1 )
	pip = ( getip $arg1 )
	teamkills = ( getteamkills $arg1 )
	spec_time = $spec_time
	
	isspectated = ( getvar $arg1 spec )
	
		if ( || ( = $teamkills $teamkill_limit ) ( > $teamkills $teamkill_limit ) ) [
		
			spectator 1 $arg1 
			setvar $arg1 spec 1
			say ( format "^f7client (%1) spectated because: ^f0Teamkilling (spectime: %2 seconds)" $pname $spec_time )
			pm $arg1 ( format "^f7You teamkilled ^f3%1 ^f7times and are ^f4spectated ^f7for ^f4%2 ^f7seconds." $teamkills $spec_time )
			
			if ( = ( getvar $arg1 spec ) 1 ) [
			 
				sleep $spec_time_total [
				
					spectator 0 $arg1
					setvar $arg1 spec 0
					pm $arg1 ( format "Your ^f3teamkilling penalty ^f7is expired. Only ^f4red ^f7players could be killed^f7." )
				]	
			]
		]
	]
]


if_tk_spec = [

sleep 1000 [

if ( = ( getvar $arg1 spec ) 1 ) [

spectator 1 $arg1 
pm $arg1 ( format "Nooo, kid, you thought, only reconnecting helps you to ^f3escape ^f7from my ^f4penalty^f7? Wrong thought." )	
		]
	]
]


reset_all_vars = [

	all = ( allplayers )
		looplist cn $all [
		
		setvar $cn spec 0
	]
]


if_wanna_unspec = [

	if ( = ( getvar $arg1 spec ) 1 ) [
	
		if ( = ( isspectator $arg1 ) 0 ) [
	
	spectator 1 $arg1 
	pm $arg1 ( format "^f7I think, you should wait until your ^f3teamkilling penalty ^f7is ^f4expired^f7." )
		]
	
	]
	
]



addhandler "onspectator" if_wanna_unspec
addhandler "onconnect" if_tk_spec 
addhandler "onteamkill" Penalty_Core
addhandler "onimission" reset_all_vars 