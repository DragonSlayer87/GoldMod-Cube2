// Spectates teamkiller, if he reached specified limit of teamkills
// made by /BudSpencer ( 2016 )
// experimental testing purpose


defaultvalue "enable_tk_penalty" 1
defaultvalue "teamkill_limit" 3 
defaultvalue "penalty_time_in_minutes" 5

spec_time_total = ( * ( 60000 ) $penalty_time_in_minutes )
penalty_list = []

Penalty_Core = [

if ( = $enable_tk_penalty 1 ) [

	pname = ( getname $arg1 )
	pcn = ( getcn $arg1 )
	pip = ( getip $arg1 )
	teamkills = ( getteamkills $arg1 )
	
		if ( || ( = $teamkills $teamkill_limit ) ( > $teamkills $teamkill_limit ) ) [
		
			spectator 1 $pcn 
			penalty_list = ( listadd $penalty_list $pcn )
			
			say ( format "^f7client (%1) spectated because: ^f0Teamkilling (spectime: %2 minutes)" $pname $penalty_time_in_minutes )
			pm $arg1 ( format "^f7You teamkilled ^f3%1 ^f7times and are ^f4spectated ^f7for ^f4%2 ^f7minutes." $teamkills $penalty_time_in_minutes )
			
			if ( > ( indexof $penalty_list $arg1 ) -1 ) [
			 
				asleep $penalty_time_in_minutes [
			
					penalty_list = ( listdel $penalty_list $pcn )
					spectator 0 $pcn 
					pm $arg1 ( format "Your ^f3teamkilling penalty ^f7is expired. Only ^f4red ^f7players could be killed^f7." )
				]	
			]
		]
	]
]


if_tk_spec = [

if ( > ( indexof $penalty_list $arg1 ) -1 ) [

spectator 1 $arg1 
pm $arg1 ( format "Nooo, kid, you thought, only reconnecting helps you to ^f3escape ^f7from my ^f4penalty^f7? Wrong thought." )	

	]
	
]


reset_all_vars = [

	all = ( allplayers )
		looplist cn $all [
		
		if ( > ( indexof $penalty_list $cn ) -1 ) [ penalty_list = ( listdel $penalty_list $cn ) ]
		
	]
	
]


if_wanna_unspec = [

	if ( > ( indexof $penalty_list $arg1 ) -1 ) [
	
		if ( = ( isspectator $arg1 ) 0 ) [
	
			spectator 1 $arg1 
			pm $arg1 ( format "^f7I think, you should wait until your ^f3teamkilling penalty ^f7is ^f4expired^f7." )

		]
	
	]
	
]



addhandler "onspectator" if_wanna_unspec
addhandler "onconnect" if_tk_spec 
addhandler "onteamkill" Penalty_Core
addhandler "onimission" reset_all_vars 