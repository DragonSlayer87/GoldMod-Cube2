// advanced IP-Adress based user login system - player can claim master/admin if registered by host
// made by /BudSpencer ( 2016 ) 


// main values
defaultvalue "enable_user_system_master" 1
defaultvalue "enable_user_system_admin" 1


cmd_master = [

if ( = $enable_user_system_master 1 ) [

if ( = ( isregistereduser ( getip $arg1 ) ) 0 ) [

	pm $arg1 ( format "^f7Cannot ^f3Authentificate ^f7your IP-Adress as ^f4Registered Master^f7." )
	
	] [
	
if ( = ( isblocked ( getip $arg1 ) ) 1 ) [

	pm $arg1 ( format "^f7Your ^f3IP-Adress ^f7is ^f4Blocked ^f7on that ^f4Server^f7." )
	
	] [
	
if ( = ( isblockedmaster ( getip $arg1 ) ) 1 ) [

	pm $arg1 ( format "^f7Your ^f3IP-Adress ^f7is ^f4Blocked ^f7on that ^f4Server^f7. You can't claim ^f4Master ^f7here." )
	
	] [
	
if ( = ( isregmaster ( getip $arg1 ) ) 1 ) [ 

isin = ( getvar $arg1 isloggedinm )

if ( = ( getvar $arg1 isloggedinm ) 0 ) [

	setpriv $arg1 2 
	
	pname = ( getname $arg1 )
	pcn = ( getcn $arg1 )
	
	say ( format "^f7Player ^f3%1(%2) ^f7is authentificated as ^f4Local Master^f7. (Username: ^f4%1^f7)" $pname $pcn )
	setvar $arg1 isloggedinm 1
	
	] [
	
	pm $arg1 ( format "^f7You are already ^f3logged in^f7. Please ^f4Logout ^f7and try again." )
					
						]
					
					]
				
				]
			
			]
		
		]
	
	] [

	pm $arg1 ( format "^f7User Login System is ^f3Disabled ^f7on that ^f4Server^f7." )
	
	]
	
]








cmd_admin = [

if ( = $enable_user_system_admin 1 ) [

if ( = ( isregistereduser ( getip $arg1 ) ) 0 ) [

	pm $arg1 ( format "^f7Cannot ^f3Authentificate ^f7your IP-Adress as ^f4Registered Admin^f7." )
	
	] [
	
if ( = ( isblocked ( getip $arg1 ) ) 1 ) [

	pm $arg1 ( format "^f7Your ^f3IP-Adress ^f7is ^f4Blocked ^f7on that ^f4Server^f7." )
	
	] [
	
if ( = ( isblockedadmin ( getip $arg1 ) ) 1 ) [

	pm $arg1 ( format "^f7Your ^f3IP-Adress ^f7is ^f4Blocked ^f7on that ^f4Server^f7. You can't claim ^f4Admin ^f7here." )
	
	] [
	
if ( = ( isregadmin ( getip $arg1 ) ) 1 ) [ 

isin = ( getvar $arg1 isloggedin )

if ( = ( getvar $arg1 isloggedin ) 0 ) [

	setpriv $arg1 3 
	
	pname = ( getname $arg1 )
	pcn = ( getcn $arg1 )
	
	say ( format "^f7Player ^f3%1(%2) ^f7is authentificated as ^f4Local Admin^f7. (Username: ^f4%1^f7)" $pname $pcn )
	setvar $arg1 isloggedin 1
	
	] [
	
	pm $arg1 ( format "^f7You are already ^f3logged in^f7. Please ^f4Logout ^f7and try again." )
					
						]
					
					]
				
				]
			
			]
		
		]
	
	] [

	pm $arg1 ( format "^f7User Login System is ^f3Disabled ^f7on that ^f4Server^f7." )
	
	]
	
]








cmd_logout_direct = [

	if ( = ( getvar $arg1 isloggedin ) 1 ) [
	
	setvar $arg1 isloggedinm 0
	setvar $arg1 isloggedin 0 
	
	say ( format "^f7Player ^f3%1(%2) ^f7successfully logged out from ^f4User System^f7." )
	
	]

]








cmd_logout = [

	if ( = ( getvar $arg1 isloggedin ) 1 ) [
	
	if ( =s $arg2 "1" ) [
	
	pm $arg1 ( format "^f7You ^f3Successfully ^f7logged out from ^f4User System^f7." )
	
	] [
	
	setvar $arg1 isloggedinm 0
	setvar $arg1 isloggedin 0 
	
	pm $arg1 ( format "^f7Are you sure, you wanna ^f3Logout ^f7from ^f4User System^f7? Type ^f4#logout 1 ^f7to logout from ^f4User System^f7." )
	
	] [
	
	pm $arg1 ( format "^f7You're not ^f3Logged In^f7. You can't ^f4logout ^f7from ^f4User System^f7." )
			
		]
		
	]

]








registered_player_msg = [

	if ( = ( isregadmin ( getip $arg1 ) ) 1 ) [
	
	pm $arg1 ( format "^f7You are ^f3Authentificated ^f7as ^f4Registered User^f7. Type ^f4#admin ^f7to claim ^f4Local Admin^f7." )
	
	] [
	
	if ( = ( isregmaster ( getip $arg1 ) ) 1 ) [
	
	pm $arg1 ( format "^f7You are ^f3Authentificated ^f7as ^f4Registered User^f7. Type ^f4#master ^f7to claim ^f4Local Master^f7." )
	
	] [
	
	if ( = ( isblocked ( getip $arg1 ) ) 1 ) [
	
	pm $arg1 ( format "^f7Your ^f3IP-Adress ^f7is ^f4blocked ^f7on this ^f4Server^f7." )
			
			]
			
		]
		
	]
	
]







	
cmd_isloggedin = [

	all = ( allplayers )
		looplist cn $all [
		
		if ( = ( getvar $arg1 isloggedin ) 1 ) [
		
		pname = ( getname $arg1 )
		pcn = ( getcn $arg1 )
		
		pm $arg1 ( format "^f7Player %1(%2) ^f7is ^f4Logged In ^f7as a ^f4Local %3^f7. (Username: ^f4%1^f7)" $pname $pcn ( getprivilege $arg1 ) )
		
		] [
		
		if ( = ( getvar $arg1 isloggedin ) 0 ) [
		
		pname = ( getname $arg1 )
		pcn = ( getcn $arg1 )
		
		pm $arg1 ( format "^f7Player %1(%2) ^f7is ^f4Logged Out^f7." $pname $pcn )
			
			]
			
		] 
		
	]
	
]




addhandler "onconnect" registered_player_msg
addhandler "ondisconnect" cmd_logout_direct

registercommand "master" cmd_master 1 "" "master ^f4This command gives a registered user master privileges."
registercommand "admin" cmd_admin 1 "" "admin ^f4This command gives a registered user admin privileges."
registercommand "logout" cmd_logout 2 "i" "logout ^f4This command logouts you from User System."
registercommand "logstate" cmd_isloggedin 1 "" "logstate ^f4This command checks login status of all players and return it."
		
		





	