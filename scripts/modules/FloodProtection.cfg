// Flood Protection - mutes flooder, who try to overflow server with text
// made by /BudSpencer ( 2016 )


defaultvalue "enable_overflow_protection" 1
defaultvalue "mute_time" 5

total_mute_time = ( * $mute_time 60000 )

Flood_Protection = [

if ( = $enable_overflow_protection 1 ) [

flood_s = ( getvar $arg1 flood )
flood_s = ( + $flood_s 1 )
setvar $arg1 flood $flood_s

ismuted_s = ( getvar $arg1 ismuted )

if ( || ( = ( getvar $arg1 flood ) 5 ) ( = ( getvar $arg1 flood ) 10 ) ) [

hasflooded_s = ( getvar $arg1 hasflooded )
hasflooded_s = ( + $hasflooded_s 1 )
setvar $arg1 hasflooded $hasflooded_s

]

sleep 5000 [

if ( > ( getvar $arg1 flood ) 0 ) [

setvar $arg1 flood 0 
	say "lol"
	]
	
]

if ( = ( getvar $arg1 ismuted ) 1 ) [

sleep $total_mute_time [

mute $arg1 0
pm $arg1 ( format "You can ^f3speak ^f7now. I hope, you ^f4learned^f7, that an ^f4overflow ^f7can kill servers." )
		
	]
	
]

if ( = ( getvar $arg1 ismuted ) 0 ) [

if ( = ( getvar $arg1 hasflooded ) 1 ) [
	
	pm $arg1 ( format "^f7You flood! Do you wanna ^f3overflow ^f7server? Stop ^f4flooding ^f7please." )
	
]
	
if ( >= ( getvar $arg1 hasflooded ) 2 ) [

	pm $arg1 ( format "^f7Okay, you seem to be ^f3interested ^f7in being ^f4muted^f7. I make you ^f4muted ^f7for ^f4%1 ^f7minutes." $mute_time )
	
	ismuted_s = ( + $ismuted_s 1 )
	setvar $arg1 ismuted 1

	mute $arg1 1
			
			]
			
		]
		
	]
	
]

addhandler "ontext" Flood_Protection

