// anti teamkill module - kicks players, who have more than a specified number of allowed teamkills
// made by /BudSpencer (2016)


//initial values
defaultvalue "tk_limit_teamplay" 5
defaultvalue "tk_limit_instateam" 5
defaultvalue "tk_limit_efficteam" 5
defaultvalue "tk_limit_tacteam" 5
defaultvalue "tk_limit_capture" 5
defaultvalue "tk_limit_regencapture" 5
defaultvalue "tk_limit_ctf" 5
defaultvalue "tk_limit_instactf"  5
defaultvalue "tk_limit_efficctf"  5
defaultvalue "tk_limit_protect"  5
defaultvalue "tk_limit_instaprotect" 5
defaultvalue "tk_limit_efficprotect" 5
defaultvalue "tk_limit_hold" 5
defaultvalue "tk_limit_instahold" 5 
defaultvalue "tk_limit_effichold" 5
defaultvalue "tk_ban_length" 180

tk_ban_length_millis = (* $tk_ban_length 60000)

tk_onteamkill = [
	tk_cn = (getalias arg1)
	mode = (at  $MODENAMES (getmode))
	tk_limit_var = [tk_limit_@mode]
	tk_limit = (getalias $tk_limit_var)
	//if limit is setted
	if (!= 0 $tk_limit) [
		tk_count = (getteamkills $arg1)
		if (> $tk_count $tk_limit) [
		tk_ban_length_millis = (* $tk_ban_length 60000)
			(pm $arg1 (format "^f1>>> ^f4You reached the ^f2teamkilling limit^f4 and got kicked from the server. Don't whine, in ^f2180 minutes ^f4you can rejoin the server. ;) ^f1<<<" ) )
			sleep 50 [ kick $tk_cn $tk_ban_length_millis "(teamkills)" ]  //kick and ban for 180 mins
		] [
			if (= $tk_count $tk_limit) [			
				(pm $arg1 (format "^f1>>> ^f4This is your ^f3LAST WARNING^f7!!! ^f4ONLY KILL ^f3REEEEED ^f4PLAYERS!!! ^f1<<<" ) )	
			] [
				(pm $arg1 (format "^f1>>> ^f4This server has a ^f2teamkilling limit^f4. If you reach it you'll ^f2kicked ^f4from server. You've made ^f2%1 ^f4of ^f2%2 ^f4allowed teamkills. ^f1<<<" $tk_count $tk_limit ) )
			]
		]
	]
]

addhandler onteamkill tk_onteamkill
