// pig mode - by star
// extended by /BudSpencer 
// useful when tournament module is enabled.

pigs = ""
pigvar = 0
//enabled = 1

getpigs = [
	allcn = $listclients
	loop i (listlen $allcn) [
		clnt = (at $allcn $i)
		if (=s (getteam $clnt) $pigteam) [
			if (!= (isspectator $clnt) 1) [ 
				pigs = (concat $pigs $clnt)
			]
		]
	]
]

enabled = 1

pigmode = [
if ( = $enabled 0 ) [
    pm $arg1 (format "^f1>>> ^f4This command is ^f2DISABLED^f4! ^f1<<<")
    ] [
	pigteam = $arg2 
	if (= $arg3 1) [
        say (format "^f1>>> ^f4initializing ^f2pigmode module ^f4... done ^f1<<<")
		say (format "^f1>>> ^f4The ^f2pigmode module ^f4has been ^f2enabled^f4. Please pick a map! ^f1<<<")
		pigvar = 1
		getpigs
		sleep 1000 [loop k (listlen @pigs) ]
	] [
		say (format "^f1>>> ^f4The ^f2pigmode module ^f4has been ^f2disabled^f4. Thank you for picking a map! ^f1<<<")
		pigvar = 0
		pigs = ""
		]
	]
]

registercommand "pig" pigmode 3 "wb" "pig <team> <1|0> ^f2This command can start/stop 'pigmode' module."


checkpig = [ 
	if (= $pigvar 1)[
		loop j (listlen $pigs) [
			if (= (at $pigs $j) @arg1) [
				sleep 1000 [suicide @@arg1
				echo (format "%1 is suicided" @@arg1)]
			]
		]
	]
]

// Doesn't work properly. Causes but one suicide on spawn when map is loaded. 
//comment by /BudSpencer: lol XD
endpig = [ 
	if (= $pigvar 1)[
		pigvar = 0
		say (format "^f1>>> ^f4The ^f2pigmode module ^f4has been ^f2disabled^f4. Thank you for picking a map! ^f1<<<")
	]
]

addhandler onspawn checkpig
addhandler onmapstart endpig