// show stats for current player
// modified by /BudSpencer (2016)


//returns string containing player's statistics
getplayerstatstr_normal = [
	str = (format "^f7Player Statistics for ^f3%1(%2)^f7:^n^f7Language: ^f4%3 ^f7| Privilege Level: ^f4%4 ^f7| Frags(Kills): ^f4%5 ^f7| Deaths: ^f4%6 ^f7| ^f7Accuracy: ^f4%7%% ^f7| KpD: ^f4%8% ^f7|" (getname $arg1) ( getcn $arg1 )  ( getlanguageger ( getcountry ( getip $arg1 ) ) ) ( getprivilege $arg1 ) (getfrags $arg1) (getdeaths $arg1) (getaccuracy $arg1) (getkpd $arg1))	
	curr_mode = (modetostr (getmode))
	// current gamemode is team mode
	if (= (isinlist $TEAMMODES $curr_mode) 1) [
		str = (concatword $str (format " ^f7Teamkills: ^f4%1 ^f7|" (getteamkills $arg1)))
		
		// current gamemode has flags
		if (= (isinlist $FLAGMODES $curr_mode) 1) [
			str = (concatword $str (format " ^f7Scored Flags: ^f4%1 ^f7|" (getflags $arg1) ))
			// str = (concatword $str (format " ^f7Returned flags: %1" (getretflags $arg1)))  // not implemented yet
		]
	]
	str = (concatword $str (format " ^f7Rank: ^f4%1^f7 ^f7|" (getrank $arg1))) 
	str = (concatword $str (format " ^f7Time: ^f4%1^f7" (formatmillis "%hh %mm %ss" (getonline $arg1))))
	result $str
]

getplayerstatstr_bots = [
	str = (format "^f7Bot Statistics for ^f3%1(%2)^f7:^n^f7Language: ^f4<unknown Language> ^f7| Frags(Kills): ^f4%3 ^f7| Deaths: ^f4%4 ^f7| ^f7Accuracy: ^f4%5%% ^f7| KpD: ^f4%6% ^f7|" (getname $arg1) ( getcn $arg1 ) (getfrags $arg1) (getdeaths $arg1) (getaccuracy $arg1) (getkpd $arg1))	
	curr_mode = (modetostr (getmode))
	// current gamemode is team mode
	if (= (isinlist $TEAMMODES $curr_mode) 1) [
		str = (concatword $str (format " ^f7Teamkills: ^f4%1 ^f7|" (getteamkills $arg1)))
		
		// current gamemode has flags
		if (= (isinlist $FLAGMODES $curr_mode) 1) [
			str = (concatword $str (format " ^f7Scored Flags: ^f4%1 ^f7|" (getflags $arg1) ))
			// str = (concatword $str (format " ^f7Returned flags: %1" (getretflags $arg1)))  // not implemented yet
		]
	]
	str = (concatword $str (format " ^f7Rank: ^f4%1^f7 ^f7|" (getrank $arg1))) 
	str = (concatword $str (format " ^f7Time: ^f4<unknown Time>^f7" ))
	result $str
]

getplayerstatstr_spec = [
	str = (format "^f7Player Statistics for ^f3%1(%2)^f7:^n^f7Language: ^f4%3 ^f7| Privilege Level: ^f4%4 ^f7| Frags(Kills): ^f4%5 ^f7| Deaths: ^f4%6 ^f7| ^f7Accuracy: ^f4%7%% ^f7| KpD: ^f4<Spectator> ^f7|" (getname $arg1) ( getcn $arg1 ) ( getlanguageger ( getcountry ( getip $arg1 ) ) ) ( getprivilege $arg1 ) (getfrags $arg1) (getdeaths $arg1) (getaccuracy $arg1) )	
	curr_mode = (modetostr (getmode))
	// current gamemode is team mode
	if (= (isinlist $TEAMMODES $curr_mode) 1) [
		str = (concatword $str (format " ^f7Teamkills: ^f4%1 ^f7|" (getteamkills $arg1)))
		
		// current gamemode has flags
		if (= (isinlist $FLAGMODES $curr_mode) 1) [
			str = (concatword $str (format " ^f7Scored Flags: ^f4%1 ^f7|" (getflags $arg1) ))
			// str = (concatword $str (format " ^f7Returned flags: %1" (getretflags $arg1)))  // not implemented yet
		]
	]
	str = (concatword $str (format " ^f7Rank: ^f4<Spectator>^f7 ^f7|" )) 
	str = (concatword $str (format " ^f7Time: ^f4%1^f7" (formatmillis "%hh %mm %ss" (getonline $arg1))))
	result $str
]

cmd_stats = [

if ( = ( playerexists $arg2 ) 0 ) [

pm $arg1 ( format "This player doesn't ^f3exist ^f7on that ^f4server^f7." )

] [

if ( =s $arg2 "-1" ) [

pm $arg1 ( format "You can't get ^f3stats ^f7of ^f4server^f7." )

] [

	if ( =s $arg2 "" ) [
	
	if ( = ( isspectator $arg1 ) 1 ) [
	
	pm $arg1 ( getplayerstatstr_spec $arg1 )
	 
	] [
	
	pm $arg1 ( getplayerstatstr_normal $arg1 )
		
		]
		
	] [
	
	if ( =s $arg2 "all" ) [
			
			all = ( allplayers )
			looplist cn $all [
			
			if ( = ( isspectator $cn ) 1 ) [
			
			s_spec = ( getplayerstatstr_spec $cn )
			pm $arg1 $s_spec
			
			] [
			
			if ( = ( isbot $cn ) 1 ) [
			
			s_bot = ( getplayerstatstr_bots $cn )
			pm $arg1 $s_bot
			
			] [
			
			s_normal = ( getplayerstatstr_normal $cn )
			pm $arg1 $s_normal
						
						]
			
					]
			
				]
			
				
			] [
			
			if ( = ( isbot $arg2 ) 1 ) [
			
			pm $arg1 ( getplayerstatstr_bots $arg2 )
			
			] [
			
			if ( isspectator $arg2 ) [
			
			pm $arg1 ( getplayerstatstr_spec $arg2 )
			
			] [
			
			pm $arg1 ( getplayerstatstr_normal $arg2 )
						
						]
						
					]
					
				]
				
			]
			
		]
		
	]
	
]

registercommand "stats" cmd_stats 1 "|s" "stats (<cn|all>) ^f3This command shows your current player stats, the stats of specified cn or stats of all players."