// beer, cookie, sweetsy, etc. :3 XD
// modified by /BudSpencer (2016)

enabled = 1

beerpoints = 20
beermax = 100

beerwant  = "^f1>>> ^f2%1 ^f4wants pint of a good beer. ^f1<<<"
beerpee = "^f1>>> ^f2%1 ^f4peed and wants one more pint of a good beer. ^f1<<<"
beerenought = "^f1>>> ^f2%1 ^f4is filled with beer and don't want more. ^f1<<<"
beermissed = "^f1>>> ^f2%1 ^f4throw away a chilly beer. ^f2Bastard^f4. ^f1<<<"

beermsg0 = "^f1>>> ^f2%1 ^f4give glass of water to ^f2%2^f7. ^f1<<<"
beermsg1 = "^f1>>> ^f2%1 ^f4passes ^f2%2 ^f4a chilly beer. ^f1<<<"
beermsg2 = "^f1>>> ^f2%1 ^f4passes ^f2%2 ^f4russian Baltika 9 beer. ^f1<<<"
beermsg3 = "^f1>>> ^f2%1 ^f4passes ^f2%2 ^f4russian Zhigulevskoe beer and package of sunflower seeds. ^f1<<<"
beermsg4 = "^f1>>> ^f2%1 ^f4passes bottle of vodka to ^f2%2^f4. After it ^f2%2 ^f4can't stand. ^f1<<<"
beermsg5 = "^f1>>> ^f2%1 ^f4is the new ^f2barkeeper^f4. ^f1<<<"
beermsg6 = "^f1>>> ^f2%1 ^f4passes ^f2%2 ^f4a bottle of brown ale. ^f1<<<"
beermsgs = 7

cmd_beer = [
	// if no reciver
if ( = $enabled 0 ) [
	pm $arg1 (format "^f1>>> ^f4This command is ^f2DISABLED^f4! ^f1<<<")
	] [
	if (=s $arg2 "") [
		beerinside = (getvar $arg1 "beer")
		if (>= $beerinside $beermax) [
			say (format $beerpee (getname $arg1))
			setvar $arg1 "beer" 0
		] [
			say (format $beerwant (getname $arg1))
		]
	] [
		// if client exists
		if (playerexists $arg2) [
			// check if enought beer
			beerinside = (getvar $arg2 "beer")
			if (>= $beerinside $beermax) [
				// full of beer
				say (format $beerenought (getname $arg2))
			] [
				// can drink more
				beeraddpoints = $beerpoints
				beermsgnum = (rnd $beermsgs) // just random number 
				beermsg = (getalias (concatword beermsg $beermsgnum)) // choose random message
				//say (format "num='%1' beermsg='%2'" $beermsgnum $beermsg)

				// extra drink can kill ;)
				if (>= $beermsgnum (- $beermsgs 1)) [
					beeraddpoints = $beermax
					suicide $arg2
				]

				say (format $beermsg (getname $arg1) (getname $arg2))
				setvar $arg2 "beer" (+ $beerinside $beeraddpoints)
			]
		] [
			// client not exists
			say (format $beermissed (getname $arg1))
			]
		]
	]
]

registercommand "beer" cmd_beer 1 "|i" "beer (<cn>) ^f2That command gives somebody an imaginary beer XD."

// clean beer point at start of match
beer_clean = [
	//say "beer clean"
	looplist cn (listclients) [
		echo $cn
		setvar $cn "beer" 0
	]
]

addhandler onmapstart beer_clean
